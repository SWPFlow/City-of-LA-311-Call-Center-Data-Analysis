{
    "contents" : "# load(\"processed_requests2.RData\")\n# load(\"data for shiny.RData\")\n\nlibrary(ggplot2)\nlibrary(dplyr)\nlibrary(lubridate)\nlibrary(viridis)\n\n# request_subset = request_data %>%\n#   select(-(ActionTaken), -(Owner), -(MobileOS), \n#          -(Anonymous), -(AssignTo), -(AddressVerified), \n#          -(ApproximateAddress), -(Address:Suffix), \n#          -(Latitude:PolicePrecinct)) %>%\n#   filter(CreatedDate > ymd_hms(\"2015-11-16 23:59:59\")) %>%\n#   mutate(day_created = day(CreatedDate))\n# \n# request_subset$weekday_created = factor(request_subset$weekday_created,\n#                                   levels = \n#                                     levels(request_subset$weekday_created)[c(2:7,1)])\n# \n# request_subset$duration_hrs = round((request_subset$UpdatedDate - request_subset$CreatedDate)/3600, \n#                               digits = 2)\n\n# There are a lot of 0s in duration. What does this mean? \n# updated right when request created\n# should we exclude 0s \n\n\n# Duration summary - by Request Type   \n\nduration_summary_plot <- function() {\n    duration_summary = request_subset %>%\n        filter(duration_hrs > 0) %>%\n        group_by(RequestType) %>%\n        summarise(mean = mean(duration_hrs), \n                  max = max(duration_hrs),\n                  min = min(duration_hrs))\n    ggplot(duration_summary, aes(x = reorder(RequestType, -mean), y = mean)) +\n        geom_bar(stat = \"identity\",\n                 fill = \"paleturquoise3\") +\n        ylab(\"Avg. Processing Time (hrs)\") +\n        xlab(\"Request Type\") +\n        ggtitle(\"Processing time of different request types\") +\n        theme_classic() +\n        theme(axis.text.x = element_text(angle = 30, hjust = 1, size = 12),\n              axis.text.y = element_text(size = 14),\n              axis.title = element_text(size=14),\n              title = element_text(size=16, face='bold'))\n}\n\n\n# Breakdown by Month   \n\nby_month_plot <- function() {\n    ggplot(request_subset, aes(x = factor(month_created))) +\n        geom_bar(fill = \"paleturquoise3\") +\n        ylab(\"Number of Requests\") +\n        xlab(\"Month of the year\") +\n        ggtitle(\"Total Requests by Month\") +\n        theme_classic() +\n        theme(axis.text.x = element_text(size = 16),\n              axis.text.y = element_text(size = 16),\n              axis.title = element_text(size=16),\n              title = element_text(size=16, face='bold'))\n}\n# Summer months have the most requests, \n# winter months have the least requests\n\n\n# By Week \n\nby_weekday_plot <- function() {\n    ggplot(request_subset, aes(x = weekday_created)) +\n        geom_bar(fill = \"paleturquoise3\") +\n        ylab(\"Number of Requests\") +\n        xlab(\"\") +\n        ggtitle(\"Total Requests by Weekday\") +\n        theme_classic() +\n        theme(axis.text.x = element_text(size = 16),\n              axis.text.y = element_text(size = 16),\n              axis.title = element_text(size=16),\n              title = element_text(size=16, face='bold'))\n}\n\n# Weekdays have far more requests than weekends -- \n#is this due to no service on weekends? \n# Do they have people answering calls on weekends\n\n\n# By Day of the month\n\n#ggplot(request_subset, aes(x = factor(day_created))) +\n#  geom_bar(fill = \"paleturquoise3\") +\n#  ylab(\"Number of Requests\") +\n#  xlab(\"Day of the month\") +\n#  ggtitle(\"Requests by Day\") +\n#  theme_classic()\n# Days at the begining of the month have more requests \n# than days at the end of the month\n\n\n# Heatmap: Weekday and Time of the day\n\nweekday_hour_heatmap <- function() {\n    request2 = request_subset %>%\n        group_by(weekday_created, hour_created) %>%\n        summarise(count = n())\n    ggplot(request2, aes(x = weekday_created, \n                         y = factor(hour_created), \n                         fill = count)) +\n        geom_tile() +\n        scale_fill_gradient(low = \"white\", high = \"deeppink4\", \n                            breaks = NULL, labels = NULL) +\n        theme_classic() +\n        ylab(\"Time of the Day\") +\n        xlab(\"\") +\n        ggtitle(\"Total Requests by Weekday and Time of the day\") +\n        theme(axis.text.x = element_text(size = 16),\n              axis.text.y = element_text(size = 16),\n              axis.title = element_text(size=16),\n              title = element_text(size=16, face='bold'))\n}\n\n# Most requests come in from 8am to 5pm, \n# whihc is probably working time of the government employees. \n# The rest might be self service/ self report\n \n \n# # Request Source by time of the day   \n# request3 = request_subset %>%\n#   group_by(RequestSource, hour_created) %>%\n#   summarise(count = n())\n# \n# ggplot(request3, aes(x = RequestSource, \n#                           y = factor(hour_created), \n#                           fill = count)) +\n#   geom_tile() +\n#   scale_fill_gradient(low = \"mistyrose\", high = \"deeppink3\", \n#                       breaks = NULL, labels = NULL) +\n#   theme_classic() +\n#   ylab(\"Time of the Day\") +\n#   xlab(\"\") +\n#   ggtitle(\"Source of Request and Time of the day\") +\n#   theme(axis.text.x = element_text(angle = 30, hjust = 1))\n# \n# \n# # Request Type by time of the day \n# \n# levels(request_subset$RequestType)\n# \n# request4 = request_subset %>%\n#   group_by(RequestType, hour_created) %>%\n#   summarise(count = n())\n# \n# ggplot(request4, aes(x = RequestType, \n#                      y = factor(hour_created), \n#                      fill = count)) +\n#   geom_tile() +\n#   scale_fill_gradient(low = \"mistyrose\", high = \"deeppink3\", \n#                       breaks = NULL, labels = NULL) +\n#   theme_classic() +\n#   ylab(\"Time of the Day\") +\n#   xlab(\"\") +\n#   ggtitle(\"Type of Request and Time of the day\") +\n#   theme(axis.text.x = element_text(angle = 30, hjust = 1))\n# # Bulky Item, Graffiti Removal are most frequent \n\n\n# Request sources\nsource_count <- function() {\n  source_data =request_subset%>%\n    group_by(RequestSource)%>%\n    summarise(count=n())%>%\n    arrange(-count)\n  \n  ggplot(source_data,aes(x=reorder(RequestSource,-count),y=count))+\n    geom_bar(stat=\"identity\",fill = \"paleturquoise3\")+\n    xlab(\"\")+\n    ylab(\"\")+\n    ggtitle(\"Request per source\")+\n    geom_text(aes(label = count), vjust = -1,size=2.5)+ \n    theme_classic()+\n    theme(axis.text.x = element_text(angle = 30, hjust = 1))\n}\n\n\n# Source and type\n\nsource_type_count <- function() {\n  request12=request_subset%>%\n    group_by(RequestSource,RequestType)%>%\n    summarise(Count=n())\n  \n  ggplot(request12,aes(x=RequestSource,y=RequestType,fill=Count))+\n    geom_tile()+\n    scale_fill_gradient(low = \"mistyrose\", high = \"deeppink3\") +\n    theme_classic() +\n    ylab(\"\") +\n    xlab(\"\") +\n    ggtitle(\"Requests by Source and Type\") +\n    theme(axis.text.x = element_text(angle = 30, hjust = 1))\n}\n\n# Request sources efficiency\n\nsource_eff <- function() {\n  request13=request_subset%>%\n    group_by(RequestSource)%>%\n    summarise(mean=round(mean(duration_hrs),2))\n  \n  ggplot(request13,aes(x=reorder(RequestSource,-mean),y=mean))+\n    geom_bar(stat=\"identity\",fill = \"paleturquoise3\")+\n    ggtitle(\"Request Efficiency by Request Source\") +\n    xlab(\"Reqeust Source\")+\n    ylab(\"Average Duration\")+\n    geom_text(aes(label = mean), vjust = -1,size=2.5)+\n    theme_classic()+\n    theme(axis.text.x = element_text(angle = 30, hjust = 1))\n}\n\n# Request Source by month   \n\nsource_month_heatmap <- function() {\n    request5 = request_subset %>%\n        group_by(RequestSource, month_created) %>%\n        summarise(count = n())\n    ggplot(request5, aes(x = RequestSource, \n                         y = factor(month_created), \n                         fill = count)) +\n        geom_tile() +\n        scale_fill_gradient(low = \"mistyrose\", high = \"deeppink3\", \n                            breaks = NULL, labels = NULL) +\n        theme_classic() +\n        ylab(\"Month of the Year\") +\n        xlab(\"\") +\n        ggtitle(\"Source of Request and Month of the Year\") +\n        theme(axis.text.x = element_text(angle = 30, hjust = 1, size = 12),\n              axis.text.y = element_text(size = 16),\n              axis.title = element_text(size=16),\n              title = element_text(size=16, face='bold'))\n}\n\n# # Request Type by month   \n# \n# request6 = request_subset %>%\n#   group_by(RequestType, month_created) %>%\n#   summarise(count = n())\n# \n# ggplot(request6, aes(x = RequestType, \n#                      y = factor(month_created), \n#                      fill = count)) +\n#   geom_tile() +\n#   scale_fill_gradient(low = \"mistyrose\", high = \"deeppink3\", \n#                       breaks = NULL, labels = NULL) +\n#   theme_classic() +\n#   ylab(\"Month of the Year\") +\n#   xlab(\"\") +\n#   ggtitle(\"Type of Request and Month of the Year\") +\n#   theme(axis.text.x = element_text(angle = 30, hjust = 1))\n\n\n\n# Request Source by weekday   \n\nsource_weekday_heatmap <- function() {\n    request7 = request_subset %>%\n        group_by(RequestSource, weekday_created) %>%\n        summarise(count = n())\n    \n    ggplot(request7, aes(x = RequestSource, \n                         y = factor(weekday_created), \n                         fill = count)) +\n        geom_tile() +\n        scale_fill_gradient(low = \"mistyrose\", high = \"deeppink3\", \n                            breaks = NULL, labels = NULL) +\n        theme_classic() +\n        ylab(\"\") +\n        xlab(\"\") +\n        ggtitle(\"Request Source by Weekday\") +\n        theme(axis.text.x = element_text(angle = 30, hjust = 1, size = 12),\n              axis.text.y = element_text(size = 16),\n              axis.title = element_text(size=16),\n              title = element_text(size=16, face='bold'))\n}\n\n\n# Request Type by Month\n\ntype_month_heatmap <- function() {\n    request6 = request_subset %>%\n        group_by(RequestType, month_created) %>%\n        summarise(count = n())\n    \n    ggplot(request6, aes(x = RequestType, \n                         y = factor(month_created), \n                         fill = count)) +\n        geom_tile() +\n        scale_fill_gradient(low = \"mistyrose\", high = \"deeppink3\", \n                            breaks = NULL, labels = NULL) +\n        theme_classic() +\n        ylab(\"Month of the Year\") +\n        xlab(\"\") +\n        ggtitle(\"Request Type by Month\") +\n        theme(axis.text.x = element_text(angle = 30, hjust = 1, size = 12),\n              axis.text.y = element_text(size = 16),\n              axis.title = element_text(size=16),\n              title = element_text(size=16, face='bold'))\n}\n\n\n# Request Type by Weekday   \n\ntype_weekday_heatmap <- function() {\n    request8 = request_subset %>%\n        group_by(RequestType, weekday_created) %>%\n        summarise(count = n())\n    \n    ggplot(request8, aes(x = RequestType, \n                         y = factor(weekday_created), \n                         fill = count)) +\n        geom_tile() +\n        scale_fill_gradient(low = \"mistyrose\", high = \"deeppink3\", \n                            breaks = NULL, labels = NULL) +\n        theme_classic() +\n        ylab(\"\") +\n        xlab(\"\") +\n        ggtitle(\"Type of Request by Weekday\") +\n        theme(axis.text.x = element_text(angle = 30, hjust = 1, size = 12),\n              axis.text.y = element_text(size = 16),\n              axis.title = element_text(size=16),\n              title = element_text(size=16, face='bold'))\n}\n\n\n# Calls\n\ncall_month_plot <- function() {\n    request_call = request_subset %>%\n        filter(RequestSource == \"Call\") %>%\n        group_by(RequestSource, month_created)\n    \n    ggplot(request_call, aes(x = factor(month_created))) +\n        geom_bar(fill = \"paleturquoise3\") +\n        ylab(\"Number of Requests\") +\n        xlab(\"Month of the year\") +\n        ggtitle(\"Calls distribution by Month\") +\n        theme_classic() +\n        theme(axis.text.x = element_text(size = 16),\n              axis.text.y = element_text(size = 16),\n              axis.title = element_text(size=16),\n              title = element_text(size=16, face='bold'))\n}\n\ncall_hour_plot <- function() {\n    request_call = request_subset %>%\n        filter(RequestSource == \"Call\") %>%\n        group_by(RequestSource, month_created)\n    \n    ggplot(request_call, aes(x = factor(hour_created))) +\n        geom_bar(fill = \"paleturquoise3\") +\n        ylab(\"Number of Requests\") +\n        xlab(\"Hour of the day\") +\n        ggtitle(\"Calls distribution by hour of the day\") +\n        theme_classic() +\n        theme(axis.text.x = element_text(size = 16),\n              axis.text.y = element_text(size = 16),\n              axis.title = element_text(size=16),\n              title = element_text(size=16, face='bold'))\n}\n\n# # Calls by weekday\n# ggplot(request_call, aes(x = weekday_created)) +\n#   geom_bar(fill = \"paleturquoise3\") +\n#   ylab(\"Number of Requests\") +\n#   xlab(\"\") +\n#   ggtitle(\"Calls distribution by weekday\") +\n#   theme_classic()\n# \n# # Bulky Item & graffiti removal  \n# request10 = request_subset %>%\n#   filter(RequestType %in% c(\"Bulky Items\", \"Graffiti Removal\")) \n# \n# # by month\n# ggplot(request10, aes(x = factor(month_created), fill = RequestType)) +\n#   geom_bar(position = position_dodge(), alpha = 0.6) +\n#   ylab(\"Number of Requests\") +\n#   xlab(\"Month of the year\") +\n#   ggtitle(\"Request Type distribution by Month\") +\n#   theme_classic()\n# \n# # by weekday\n# ggplot(request10, aes(x = weekday_created, fill = RequestType)) +\n#   geom_bar(position = position_dodge(), alpha = 0.6) +\n#   ylab(\"Number of Requests\") +\n#   xlab(\"\") +\n#   ggtitle(\"Request Type distribution by weekday\") +\n#   theme_classic()\n# \n# \n# \n# # Dead Animal removal by month\n# request_subset1 = request_subset %>%\n#   filter(RequestType == \"Dead Animal Removal\")\n# \n# ggplot(request_subset1, aes(x = factor(month_created))) +\n#   geom_bar(position = position_dodge(), fill = \"lightblue\") +\n#   ylab(\"Number of Requests\") +\n#   xlab(\"Month of the year\") +\n#   ggtitle(\"Dead Animal Removal requests by Month\") +\n#   theme_classic()\n# \n# ## Chun\n# \n# request_subset2 = request_data%>%\n#   group_by(RequestSource, RequestType)%>%\n#   summarise(Count=n())\n# \n# ggplot(request_subset2,aes(x=RequestSource, y=RequestType, fill=Count))+\n#   geom_tile()+\n#   scale_fill_gradient(low = \"mistyrose\", high = \"deeppink3\") +\n#   theme_classic() +\n#   ylab(\"\") +\n#   xlab(\"\") +\n#   ggtitle(\"Requests by Source and Type\") +\n#   theme(axis.text.x = element_text(angle = 30, hjust = 1))\n",
    "created" : 1480919000634.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2984281141",
    "id" : "83266223",
    "lastKnownWriteTime" : 1481075019,
    "path" : "~/Desktop/DSO545/Final project/fight-on/Shiny_time/time_based.R",
    "project_path" : "time_based.R",
    "properties" : {
    },
    "relative_order" : 3,
    "source_on_save" : false,
    "type" : "r_source"
}