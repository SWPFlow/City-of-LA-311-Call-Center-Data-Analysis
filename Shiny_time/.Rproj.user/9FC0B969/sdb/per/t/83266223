{
    "contents" : "#load(\"processed_requests2.RData\")\n\nlibrary(ggplot2)\nlibrary(dplyr)\nlibrary(lubridate)\nlibrary(viridis)\n\nrequest1 = request_data %>%\n  select(-(ActionTaken), -(Owner), -(MobileOS), \n         -(Anonymous), -(AssignTo), -(AddressVerified), \n         -(ApproximateAddress), -(Address:Suffix), \n         -(Latitude:PolicePrecinct)) %>%\n  filter(CreatedDate > ymd_hms(\"2015-11-16 23:59:59\")) %>%\n  mutate(day_created = day(CreatedDate))\n\nrequest1$weekday_created = factor(request1$weekday_created,\n                                  levels = \n                                    levels(request1$weekday_created)[c(2:7,1)])\n\nrequest1$duration_hrs = round((request1$UpdatedDate - request1$CreatedDate)/3600, \n                              digits = 2)\n\n# There are a lot of 0s in duration. What does this mean? \n# updated right when request created\n# should we exclude 0s \n\n\n# Duration summary - by Request Type   \n\nduration_summary = request1 %>%\n  filter(duration_hrs > 0) %>%\n  group_by(RequestType) %>%\n  summarise(mean = mean(duration_hrs), \n            max = max(duration_hrs),\n            min = min(duration_hrs))\n# Duration have negative numbers \n# filtering out 0s leads to different ordering \nggplot(duration_summary, aes(x = reorder(RequestType, -mean), y = mean)) +\n  geom_bar(stat = \"identity\",\n           fill = \"paleturquoise3\") +\n  ylab(\"Avg. Processing Time\") +\n  xlab(\"Request Type\") +\n  ggtitle(\"Processing time of different request types\") +\n  theme_classic() +\n  theme(axis.text.x = element_text(angle = 30, hjust = 1))\n\n\n\n# Breakdown by Month   \n\nggplot(request1, aes(x = factor(month_created))) +\n  geom_bar(fill = \"paleturquoise3\") +\n  ylab(\"Number of Requests\") +\n  xlab(\"Month of the year\") +\n  ggtitle(\"Requests by Month\") +\n  theme_classic()\n# Summer months have the most requests, \n# winter months have the least requests\n\n\n# By Week \n\nggplot(request1, aes(x = weekday_created)) +\n  geom_bar(fill = \"paleturquoise3\") +\n  ylab(\"Number of Requests\") +\n  xlab(\"\") +\n  ggtitle(\"Requests by Week\") +\n  theme_classic()\n# Weekdays have far more requests than weekends -- \n#is this due to no service on weekends? \n# Do they have people answering calls on weekends\n\n\n# By Day of the month\n\n#ggplot(request1, aes(x = factor(day_created))) +\n#  geom_bar(fill = \"paleturquoise3\") +\n#  ylab(\"Number of Requests\") +\n#  xlab(\"Day of the month\") +\n#  ggtitle(\"Requests by Day\") +\n#  theme_classic()\n# Days at the begining of the month have more requests \n# than days at the end of the month\n\n\n# Heatmap: Weekday and Time of the day\n\nrequest2 = request1 %>%\n  group_by(weekday_created, hour_created) %>%\n  summarise(count = n())\n\nggplot(request2, aes(x = weekday_created, \n                          y = factor(hour_created), \n                          fill = count)) +\n  geom_tile() +\n  scale_fill_gradient(low = \"white\", high = \"deeppink4\", \n                      breaks = NULL, labels = NULL) +\n  theme_classic() +\n  ylab(\"Time of the Day\") +\n  xlab(\"\") +\n  ggtitle(\"Requests by Weekday and Time of the day\")\n# Most requests come in from 8am to 5pm, \n# whihc is probably working time of the government employees. \n# The rest might be self service/ self report\n\n\n# Request Source by time of the day   \nrequest3 = request1 %>%\n  group_by(RequestSource, hour_created) %>%\n  summarise(count = n())\n\nggplot(request3, aes(x = RequestSource, \n                          y = factor(hour_created), \n                          fill = count)) +\n  geom_tile() +\n  scale_fill_gradient(low = \"mistyrose\", high = \"deeppink3\", \n                      breaks = NULL, labels = NULL) +\n  theme_classic() +\n  ylab(\"Time of the Day\") +\n  xlab(\"\") +\n  ggtitle(\"Source of Request and Time of the day\") +\n  theme(axis.text.x = element_text(angle = 30, hjust = 1))\n\n\n# Request Type by time of the day \n\nlevels(request1$RequestType)\n\nrequest4 = request1 %>%\n  group_by(RequestType, hour_created) %>%\n  summarise(count = n())\n\nggplot(request4, aes(x = RequestType, \n                     y = factor(hour_created), \n                     fill = count)) +\n  geom_tile() +\n  scale_fill_gradient(low = \"mistyrose\", high = \"deeppink3\", \n                      breaks = NULL, labels = NULL) +\n  theme_classic() +\n  ylab(\"Time of the Day\") +\n  xlab(\"\") +\n  ggtitle(\"Type of Request and Time of the day\") +\n  theme(axis.text.x = element_text(angle = 30, hjust = 1))\n# Bulky Item, Graffiti Removal are most frequent \n\n\n\n# Request Source by month   \n\nrequest5 = request1 %>%\n  group_by(RequestSource, month_created) %>%\n  summarise(count = n())\n\nggplot(request5, aes(x = RequestSource, \n                     y = factor(month_created), \n                     fill = count)) +\n  geom_tile() +\n  scale_fill_gradient(low = \"mistyrose\", high = \"deeppink3\", \n                      breaks = NULL, labels = NULL) +\n  theme_classic() +\n  ylab(\"Month of the Year\") +\n  xlab(\"\") +\n  ggtitle(\"Source of Request and Month of the Year\") +\n  theme(axis.text.x = element_text(angle = 30, hjust = 1))\n\n\n# Request Type by month   \n\nrequest6 = request1 %>%\n  group_by(RequestType, month_created) %>%\n  summarise(count = n())\n\nggplot(request6, aes(x = RequestType, \n                     y = factor(month_created), \n                     fill = count)) +\n  geom_tile() +\n  scale_fill_gradient(low = \"mistyrose\", high = \"deeppink3\", \n                      breaks = NULL, labels = NULL) +\n  theme_classic() +\n  ylab(\"Month of the Year\") +\n  xlab(\"\") +\n  ggtitle(\"Type of Request and Month of the Year\") +\n  theme(axis.text.x = element_text(angle = 30, hjust = 1))\n\n\n\n# Request Source by weekday   \n\nrequest7 = request1 %>%\n  group_by(RequestSource, weekday_created) %>%\n  summarise(count = n())\n\nggplot(request7, aes(x = RequestSource, \n                     y = factor(weekday_created), \n                     fill = count)) +\n  geom_tile() +\n  scale_fill_gradient(low = \"mistyrose\", high = \"deeppink3\", \n                      breaks = NULL, labels = NULL) +\n  theme_classic() +\n  ylab(\"\") +\n  xlab(\"\") +\n  ggtitle(\"Source of Request and Weekday\") +\n  theme(axis.text.x = element_text(angle = 30, hjust = 1))\n\n\n\n# Request Type by Weekday   \n\nrequest8 = request1 %>%\n  group_by(RequestType, weekday_created) %>%\n  summarise(count = n())\n\nggplot(request8, aes(x = RequestType, \n                     y = factor(weekday_created), \n                     fill = count)) +\n  geom_tile() +\n  scale_fill_gradient(low = \"mistyrose\", high = \"deeppink3\", \n                      breaks = NULL, labels = NULL) +\n  theme_classic() +\n  ylab(\"\") +\n  xlab(\"\") +\n  ggtitle(\"Type of Request and Weekday\") +\n  theme(axis.text.x = element_text(angle = 30, hjust = 1))\n\n\n\n# Calls\n\nrequest9 = request1 %>%\n  filter(RequestSource == \"Call\") %>%\n  group_by(RequestSource, month_created)\n\n# Calls by month\nggplot(request9, aes(x = factor(month_created))) +\n  geom_bar(fill = \"paleturquoise3\") +\n  ylab(\"Number of Requests\") +\n  xlab(\"Month of the year\") +\n  ggtitle(\"Calls distribution by Month\") +\n  theme_classic()\n\n# Calls by weekday\nggplot(request9, aes(x = weekday_created)) +\n  geom_bar(fill = \"paleturquoise3\") +\n  ylab(\"Number of Requests\") +\n  xlab(\"\") +\n  ggtitle(\"Calls distribution by weekday\") +\n  theme_classic()\n\n# Calls by hour\nggplot(request9, aes(x = factor(hour_created))) +\n  geom_bar(fill = \"paleturquoise3\") +\n  ylab(\"Number of Requests\") +\n  xlab(\"Hour of the day\") +\n  ggtitle(\"Calls distribution by hour of the day\") +\n  theme_classic()\n\n\n# Bulky Item & graffiti removal  \nrequest10 = request1 %>%\n  filter(RequestType %in% c(\"Bulky Items\", \"Graffiti Removal\")) \n\n# by month\nggplot(request10, aes(x = factor(month_created), fill = RequestType)) +\n  geom_bar(position = position_dodge(), alpha = 0.6) +\n  ylab(\"Number of Requests\") +\n  xlab(\"Month of the year\") +\n  ggtitle(\"Request Type distribution by Month\") +\n  theme_classic()\n\n# by weekday\nggplot(request10, aes(x = weekday_created, fill = RequestType)) +\n  geom_bar(position = position_dodge(), alpha = 0.6) +\n  ylab(\"Number of Requests\") +\n  xlab(\"\") +\n  ggtitle(\"Request Type distribution by weekday\") +\n  theme_classic()\n\n\n\n# Dead Animal removal by month\nrequest11 = request1 %>%\n  filter(RequestType == \"Dead Animal Removal\")\n\nggplot(request11, aes(x = factor(month_created))) +\n  geom_bar(position = position_dodge(), fill = \"lightblue\") +\n  ylab(\"Number of Requests\") +\n  xlab(\"Month of the year\") +\n  ggtitle(\"Dead Animal Removal requests by Month\") +\n  theme_classic()\n\n## Chun\n\nrequest12 = request_data%>%\n  group_by(RequestSource, RequestType)%>%\n  summarise(Count=n())\n\nggplot(request12,aes(x=RequestSource, y=RequestType, fill=Count))+\n  geom_tile()+\n  scale_fill_gradient(low = \"mistyrose\", high = \"deeppink3\") +\n  theme_classic() +\n  ylab(\"\") +\n  xlab(\"\") +\n  ggtitle(\"Requests by Source and Type\") +\n  theme(axis.text.x = element_text(angle = 30, hjust = 1))\n",
    "created" : 1480919000634.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "825809894",
    "id" : "83266223",
    "lastKnownWriteTime" : 1480919055,
    "path" : "~/Desktop/DSO545/Final project/fight-on/Shiny_time/time_based.R",
    "project_path" : "time_based.R",
    "properties" : {
    },
    "relative_order" : 3,
    "source_on_save" : false,
    "type" : "r_source"
}